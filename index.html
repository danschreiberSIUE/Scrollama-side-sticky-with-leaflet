<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Lovejoy Library</title>
    <meta name="description" content="Scrollama: Sticky Side Example" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="leafletMaps.js"></script>
    ;
    <style>
      #scrolly-container {
        position: relative;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        padding: 1rem;
      }

      #scrolly-container > * {
        -webkit-box-flex: 1;
        -ms-flex: 1;
        flex: 1;
      }

      #sticky-image {
        position: -webkit-sticky;
        position: sticky;
        width: 100%;
        margin: 0;
        z-index: 0;
        top: 12.5vh;
        height: 75vh;
        /* Center everything inside */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;

        display: none; /* hide by default, let meta data decide when to display */
      }

      #sticky-image img {
        padding: 0rem;
        object-fit: cover;
        width: 100%;
        height: 100%;
        overflow: hidden;

        transition: transform 1s ease-in;
      }

      #sticky-map {
        position: -webkit-sticky;
        position: sticky;
        width: 100%;
        top: 12.5vh;
        height: 75vh;
        display: none; /* hide by default, let meta data decide when to display */
      }

      article {
        position: relative;

        padding: 0 0rem;
        max-width: 20rem;
      }

      .step {
        margin: 0rem 1rem 10rem 0rem;
        color: #fff;
        height: 50vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .step:first-child {
        margin-top: 5rem;
      }
      .step:last-child {
        margin-bottom: 0;
      }

      .step.is-active {
        background-color: #0001;
        color: #3b3b3b;
      }

      .step p {
        text-align: center;
        padding: 1rem;
        font-size: 1.5rem;
      }
    </style>
  </head>

  <body>
    <main>
      <section id="intro">
        <h1 class="intro__hed">Lovejoy Library</h1>
        <p class="intro__dek"></p>
      </section>

      <section id="scrolly-container">
        <article>
          <div
            class="step"
            data-step="1"
            data-sticky-type="image"
            data-sticky-image="Lovejoy.jpg"
          >
            <p>This is Lovejoy Library</p>
          </div>
          <div
            class="step"
            data-step="2"
            data-sticky-type="image"
            data-zoom="1.5"
          >
            <p>
              It was built in 1066 by the Normans as an impenetrable fortress.
            </p>
          </div>
          <div
            class="step"
            data-step="3"
            data-sticky-type="map"
            data-lat="38.7940"
            data-long="-89.9979"
            data-zoom="19"
          >
            <p>
              Located within the heart of the SIUE campus, it has been conquered
              by department fiefs living off scraps of the written word
            </p>
          </div>
          <div
            class="step"
            data-step="4"
            data-sticky-type="map"
            data-lat="38.8078"
            data-long="-89.9636"
            data-zoom="12"
          >
            <p>
              SIUE is located in Edwardsville, Illinois, ESE of world-renown
              South Roxana IL
            </p>
          </div>
          <div
            class="step"
            data-step="5"
            data-sticky-type="map"
            data-lat="38.9"
            data-long="-90.18"
            data-zoom="13"
          >
            <p>It is also 30 miles from Alton IL</p>
          </div>
          <div
            class="step"
            data-step="6"
            data-sticky-type="image"
            data-sticky-image="ElijahLovejoy.jpg"
          >
            <p>
              Alton was the home of Elijah P. Lovejoy, the library's namesake
            </p>
          </div>
          <div
            class="step"
            data-step="7"
            data-sticky-type="image"
            data-sticky-image="LovejoyMob.jpg"
          >
            <p>He was killed by an angry Pro-Slavery Mob</p>
          </div>
        </article>

        <!-- Each kind of sticky thing has it's own container to show/hide when it is part of a step-->
        <div id="sticky-image"></div>
        <div id="sticky-map"></div>
      </section>

      <section id="outro">
        <p>Bummer.</p>
      </section>
    </main>

    <!-- <div class='debug'></div> -->
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script>
      var main = document.querySelector("main");
      var scrolly = main.querySelector("#scrolly-container");
      var stickyImage = scrolly.querySelector("#sticky-image");
      var stickyMap = scrolly.querySelector("#sticky-map");
      var story = scrolly.querySelector("article");
      var steps = story.querySelectorAll(".step");

      // initialize the scrollama
      var scroller = scrollama();

      // scrollama event handlers
      function handleStepEnter(response) {
        var el = response.element;

        // Set active step state to is-active and all othe steps not active
        steps.forEach((step) => step.classList.remove("is-active"));
        el.classList.add("is-active");

        // Swap out image or map based on meta data
        if (el.dataset.stickyType === "image") {
          if (el.dataset.stickyImage) {
            stickyImage.innerHTML = `<img src="${el.dataset.stickyImage}" alt="TODO" />`;
            stickyImage.style.display = "block"; // TODO Move to CSS, create an active/inactive class
            stickyMap.style.display = "none";
          }
          if (el.dataset.zoom) {
            let img = stickyImage.querySelector("img");
            if (img) {
              img.style.transform = `scale(${el.dataset.zoom})`;
            }
          }
        } else if (el.dataset.stickyType === "map") {
          stickyImage.style.display = "none"; // TODO Move to CSS, create an active/inactive class
          stickyMap.style.display = "block";
          displayStickyMap(el.dataset.lat, el.dataset.long, el.dataset.zoom);
        }
      }

      function replaceStepContent(stepData) {}

      function init() {
        scroller
          .setup({
            step: "#scrolly-container article .step",
            offset: 0.7, // what % from the top of the viewport the step should be considered "entered"
            debug: false,
          })
          .onStepEnter(handleStepEnter);

        // setup resize event
        window.addEventListener("resize", scroller.resize);
      }

      // kick things off
      init();
    </script>
  </body>
</html>
